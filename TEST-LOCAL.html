<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Local - App Suivi Nageurs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            transition: all 0.3s;
        }
        
        .test-section:hover {
            border-color: #667eea;
            box-shadow: 0 5px 20px rgba(102,126,234,0.1);
        }
        
        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
        }
        
        .test-section p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .checklist {
            display: grid;
            gap: 10px;
        }
        
        .check-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        
        .check-item.pass {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }
        
        .check-item.fail {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        
        .check-item.pending {
            background: #fff3cd;
            border-left: 4px solid #ff9800;
        }
        
        .check-icon {
            font-size: 1.3rem;
            min-width: 25px;
        }
        
        .check-item.pass .check-icon {
            color: #4caf50;
        }
        
        .check-item.fail .check-icon {
            color: #f44336;
        }
        
        .check-item.pending .check-icon {
            color: #ff9800;
        }
        
        .buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102,126,234,0.3);
        }
        
        .btn-success {
            background: #4caf50;
            color: white;
        }
        
        .btn-success:hover {
            background: #45a049;
        }
        
        .btn-warning {
            background: #ff9800;
            color: white;
        }
        
        .btn-warning:hover {
            background: #e68900;
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-badge.success {
            background: #c8e6c9;
            color: #2e7d32;
        }
        
        .status-badge.pending {
            background: #ffe0b2;
            color: #e65100;
        }
        
        .status-badge.error {
            background: #ffcdd2;
            color: #c62828;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .info-box strong {
            color: #1976d2;
        }
        
        .footer {
            background: #f5f5f5;
            padding: 20px;
            text-align: center;
            color: #666;
            border-top: 1px solid #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-swimmer"></i> Test Local - Suivi Nageurs</h1>
            <p>V√©rification des fonctionnalit√©s principales</p>
        </div>
        
        <div class="content">
            <!-- Section 1: Infrastructure -->
            <div class="test-section">
                <h2><i class="fas fa-server"></i> 1. Infrastructure</h2>
                <p>V√©rifier que le serveur et les fichiers sont accessibles.</p>
                
                <div class="checklist">
                    <div class="check-item pass">
                        <div class="check-icon"><i class="fas fa-check-circle"></i></div>
                        <div>Serveur local en cours d'ex√©cution sur port 8000</div>
                    </div>
                    <div class="check-item pending" id="check-index">
                        <div class="check-icon"><i class="fas fa-spinner fa-spin"></i></div>
                        <div>Acc√®s √† index.html</div>
                    </div>
                    <div class="check-item pending" id="check-equipe">
                        <div class="check-icon"><i class="fas fa-spinner fa-spin"></i></div>
                        <div>Acc√®s √† equipe.html</div>
                    </div>
                    <div class="check-item pending" id="check-dashboard-js">
                        <div class="check-icon"><i class="fas fa-spinner fa-spin"></i></div>
                        <div>Chargement equipe-dashboard.js</div>
                    </div>
                    <div class="check-item pending" id="check-attendance-js">
                        <div class="check-icon"><i class="fas fa-spinner fa-spin"></i></div>
                        <div>Chargement attendance-form.js (nouvelle architecture)</div>
                    </div>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-primary" onclick="testInfrastructure()">
                        <i class="fas fa-play"></i> Tester Infrastructure
                    </button>
                </div>
            </div>
            
            <!-- Section 2: Formulaire de Pr√©sence -->
            <div class="test-section">
                <h2><i class="fas fa-clipboard-list"></i> 2. Formulaire de Pr√©sence</h2>
                <p>Tester les fonctionnalit√©s du formulaire de suivi de pr√©sence.</p>
                
                <div class="checklist">
                    <div class="check-item pending" id="check-form-render">
                        <div class="check-icon"><i class="fas fa-spinner fa-spin"></i></div>
                        <div>Rendu du formulaire de pr√©sence</div>
                    </div>
                    <div class="check-item pending" id="check-date-selector">
                        <div class="check-icon"><i class="fas fa-spinner fa-spin"></i></div>
                        <div>S√©lecteur de date fonctionnel</div>
                    </div>
                    <div class="check-item pending" id="check-status-buttons">
                        <div class="check-icon"><i class="fas fa-spinner fa-spin"></i></div>
                        <div>Boutons de statut cycliques</div>
                    </div>
                    <div class="check-item pending" id="check-status-counts">
                        <div class="check-icon"><i class="fas fa-spinner fa-spin"></i></div>
                        <div>Compteurs de statuts en temps r√©el</div>
                    </div>
                    <div class="check-item pending" id="check-calendar">
                        <div class="check-icon"><i class="fas fa-spinner fa-spin"></i></div>
                        <div>Calendrier visuel pour s√©lection date</div>
                    </div>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-success" onclick="testAttendanceForm()">
                        <i class="fas fa-play"></i> Tester Formulaire
                    </button>
                    <button class="btn btn-primary" onclick="window.location.href='http://localhost:8000/equipe.html'">
                        <i class="fas fa-external-link-alt"></i> Ouvrir √âquipe
                    </button>
                </div>
            </div>
            
            <!-- Section 3: Stockage Local -->
            <div class="test-section">
                <h2><i class="fas fa-database"></i> 3. Stockage Local (localStorage)</h2>
                <p>V√©rifier que les donn√©es de pr√©sence sont sauvegard√©es.</p>
                
                <div class="checklist">
                    <div class="check-item pending" id="check-localStorage">
                        <div class="check-icon"><i class="fas fa-spinner fa-spin"></i></div>
                        <div>localStorage accessible</div>
                    </div>
                    <div class="check-item pending" id="check-swimmers-data">
                        <div class="check-icon"><i class="fas fa-spinner fa-spin"></i></div>
                        <div>Donn√©es des nageurs pr√©sentes</div>
                    </div>
                    <div class="check-item pending" id="check-attendance-data">
                        <div class="check-icon"><i class="fas fa-spinner fa-spin"></i></div>
                        <div>Historique de pr√©sence sauvegard√©</div>
                    </div>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-warning" onclick="testLocalStorage()">
                        <i class="fas fa-database"></i> Tester localStorage
                    </button>
                    <button class="btn btn-primary" onclick="showStorageData()">
                        <i class="fas fa-eye"></i> Afficher les donn√©es
                    </button>
                </div>
            </div>
            
            <!-- Section 4: Actions Rapides -->
            <div class="test-section">
                <h2><i class="fas fa-bolt"></i> 4. Actions Rapides</h2>
                <p>Acc√®s direct aux sections principales de l'application.</p>
                
                <div class="grid">
                    <button class="btn btn-primary" onclick="window.location.href='http://localhost:8000/index.html'">
                        <i class="fas fa-home"></i> Accueil
                    </button>
                    <button class="btn btn-primary" onclick="window.location.href='http://localhost:8000/equipe.html'">
                        <i class="fas fa-users"></i> √âquipe
                    </button>
                    <button class="btn btn-primary" onclick="window.location.href='http://localhost:8000/dashboard.html'">
                        <i class="fas fa-chart-pie"></i> Dashboard
                    </button>
                    <button class="btn btn-primary" onclick="window.location.href='http://localhost:8000/nageur.html'">
                        <i class="fas fa-swimmer"></i> Nageur
                    </button>
                </div>
            </div>
            
            <!-- Section 5: Console & Diagnostics -->
            <div class="test-section">
                <h2><i class="fas fa-bug"></i> 5. Diagnostics</h2>
                <p>Informations de diagnostic sur le syst√®me.</p>
                
                <div class="info-box">
                    <strong>üí° Astuce:</strong> Ouvrez la console du navigateur (F12 ‚Üí Console) pour voir les logs d√©taill√©s.
                </div>
                
                <div class="buttons">
                    <button class="btn btn-warning" onclick="runDiagnostics()">
                        <i class="fas fa-stethoscope"></i> Ex√©cuter Diagnostics
                    </button>
                    <button class="btn btn-primary" onclick="clearLocalStorage()">
                        <i class="fas fa-trash"></i> Vider localStorage
                    </button>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>üîß Test local - Suivi Nageurs v1.0 | Port 8000</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">
                Pour arr√™ter le serveur: Ctrl+C dans le terminal | 
                <a href="http://localhost:8000" style="color: #667eea; text-decoration: none;">Serveur local</a>
            </p>
        </div>
    </div>

    <script>
        // ============================================
        // TESTS INFRASTRUCTURE
        // ============================================
        
        async function testInfrastructure() {
            console.log('üîç Test Infrastructure - D√©but');
            
            const tests = [
                { id: 'check-index', url: '/', name: 'index.html' },
                { id: 'check-equipe', url: '/equipe.html', name: 'equipe.html' },
                { id: 'check-dashboard-js', url: '/assets/js/equipe-dashboard.js', name: 'equipe-dashboard.js' },
                { id: 'check-attendance-js', url: '/assets/js/attendance-form.js', name: 'attendance-form.js' }
            ];
            
            for (const test of tests) {
                try {
                    const response = await fetch(test.url);
                    if (response.ok) {
                        updateCheck(test.id, 'pass', `‚úÖ ${test.name} - ${response.status} OK`);
                        console.log(`‚úÖ ${test.name} accessible`);
                    } else {
                        updateCheck(test.id, 'fail', `‚ùå ${test.name} - ${response.status}`);
                        console.error(`‚ùå ${test.name} - ${response.status}`);
                    }
                } catch (error) {
                    updateCheck(test.id, 'fail', `‚ùå ${test.name} - Erreur`);
                    console.error(`‚ùå ${test.name}:`, error.message);
                }
            }
            
            alert('‚úÖ Test infrastructure termin√©! Consultez la console pour les d√©tails.');
        }
        
        // ============================================
        // TESTS FORMULAIRE
        // ============================================
        
        function testAttendanceForm() {
            console.log('üéØ Test Formulaire de Pr√©sence - D√©but');
            
            let score = 0;
            let total = 0;
            
            // Test 1: Fonction renderAttendanceForm existe
            total++;
            if (typeof renderAttendanceForm === 'function') {
                updateCheck('check-form-render', 'pass', '‚úÖ renderAttendanceForm() disponible');
                score++;
                console.log('‚úÖ renderAttendanceForm existe');
            } else {
                updateCheck('check-form-render', 'fail', '‚ùå renderAttendanceForm() manquante');
                console.error('‚ùå renderAttendanceForm n\'existe pas');
            }
            
            // Test 2: S√©lecteur date
            total++;
            if (document.getElementById('attendanceDate')) {
                updateCheck('check-date-selector', 'pass', '‚úÖ Input date pr√©sent');
                score++;
            } else {
                updateCheck('check-date-selector', 'pending', '‚è≥ Input date non trouv√© (charger formulaire d\'abord)');
            }
            
            // Test 3: Boutons statut
            total++;
            if (document.querySelectorAll('.attendance-status-btn').length > 0) {
                updateCheck('check-status-buttons', 'pass', `‚úÖ ${document.querySelectorAll('.attendance-status-btn').length} boutons trouv√©s`);
                score++;
            } else {
                updateCheck('check-status-buttons', 'pending', '‚è≥ Boutons non trouv√©s (charger formulaire d\'abord)');
            }
            
            // Test 4: Compteurs
            total++;
            if (document.getElementById('presentCount')) {
                updateCheck('check-status-counts', 'pass', '‚úÖ Compteurs pr√©sents');
                score++;
            } else {
                updateCheck('check-status-counts', 'pending', '‚è≥ Compteurs non trouv√©s (charger formulaire d\'abord)');
            }
            
            // Test 5: Fonction calendrier
            total++;
            if (typeof openAttendanceCalendarForEdit === 'function') {
                updateCheck('check-calendar', 'pass', '‚úÖ Calendrier disponible');
                score++;
                console.log('‚úÖ Calendrier fonction disponible');
            } else {
                updateCheck('check-calendar', 'fail', '‚ùå Calendrier indisponible');
                console.error('‚ùå Calendrier manquant');
            }
            
            alert(`‚úÖ Test formulaire: ${score}/${total} r√©ussis!`);
        }
        
        // ============================================
        // TESTS LOCALSTORAGE
        // ============================================
        
        function testLocalStorage() {
            console.log('üíæ Test localStorage - D√©but');
            
            // Test 1: localStorage accessible
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                updateCheck('check-localStorage', 'pass', '‚úÖ localStorage accessible');
                console.log('‚úÖ localStorage OK');
            } catch (error) {
                updateCheck('check-localStorage', 'fail', '‚ùå localStorage indisponible');
                console.error('‚ùå localStorage:', error.message);
                return;
            }
            
            // Test 2: Donn√©es nageurs
            try {
                const swimmers = JSON.parse(localStorage.getItem('swimmers') || '[]');
                if (swimmers.length > 0) {
                    updateCheck('check-swimmers-data', 'pass', `‚úÖ ${swimmers.length} nageur(s) trouv√©(s)`);
                    console.log(`‚úÖ ${swimmers.length} nageurs en localStorage`);
                } else {
                    updateCheck('check-swimmers-data', 'pending', '‚è≥ Aucun nageur (donn√©es vides)');
                    console.log('‚è≥ localStorage vide');
                }
            } catch (error) {
                updateCheck('check-swimmers-data', 'fail', '‚ùå Erreur de parsing');
                console.error('‚ùå Erreur:', error.message);
            }
            
            // Test 3: Historique pr√©sence
            try {
                const swimmers = JSON.parse(localStorage.getItem('swimmers') || '[]');
                let attendanceCount = 0;
                swimmers.forEach(s => {
                    if (s.attendanceData) {
                        attendanceCount += s.attendanceData.length;
                    }
                });
                
                if (attendanceCount > 0) {
                    updateCheck('check-attendance-data', 'pass', `‚úÖ ${attendanceCount} enregistrement(s) de pr√©sence`);
                    console.log(`‚úÖ ${attendanceCount} pr√©sences en localStorage`);
                } else {
                    updateCheck('check-attendance-data', 'pending', '‚è≥ Aucune pr√©sence enregistr√©e');
                }
            } catch (error) {
                updateCheck('check-attendance-data', 'fail', '‚ùå Erreur');
                console.error('‚ùå Erreur:', error.message);
            }
            
            alert('‚úÖ Test localStorage termin√©!');
        }
        
        function showStorageData() {
            console.clear();
            console.log('üìä DONN√âES LOCALSTORAGE:');
            console.log('=======================');
            
            try {
                const swimmers = JSON.parse(localStorage.getItem('swimmers') || '[]');
                console.log(`Nageurs (${swimmers.length}):`);
                swimmers.forEach((s, i) => {
                    console.log(`  ${i+1}. ${s.name} (${s.id})`);
                    if (s.attendanceData) {
                        console.log(`     ‚Üí ${s.attendanceData.length} pr√©sence(s)`);
                        s.attendanceData.slice(-3).forEach(a => {
                            console.log(`        ${a.date}: ${a.status}`);
                        });
                    }
                });
            } catch (error) {
                console.error('Erreur:', error.message);
            }
            
            alert('Donn√©es affich√©es dans la console (F12)');
        }
        
        // ============================================
        // DIAGNOSTICS
        // ============================================
        
        function runDiagnostics() {
            console.clear();
            console.log('üîç DIAGNOSTICS SYST√àME:');
            console.log('=======================\n');
            
            // 1. Navigateur
            console.log('1Ô∏è‚É£ NAVIGATEUR:');
            console.log(`  Navigateur: ${navigator.userAgent}`);
            console.log(`  Langue: ${navigator.language}`);
            console.log(`  En ligne: ${navigator.onLine ? '‚úÖ OUI' : '‚ùå NON'}\n`);
            
            // 2. localStorage
            console.log('2Ô∏è‚É£ STOCKAGE:');
            try {
                const testKey = '_test_' + Date.now();
                localStorage.setItem(testKey, 'test');
                const available = localStorage.getItem(testKey) === 'test';
                localStorage.removeItem(testKey);
                console.log(`  localStorage: ${available ? '‚úÖ DISPONIBLE' : '‚ùå INDISPONIBLE'}`);
                console.log(`  Taille utilis√©e: ${JSON.stringify(localStorage).length} bytes\n`);
            } catch (error) {
                console.log(`  localStorage: ‚ùå ERREUR - ${error.message}\n`);
            }
            
            // 3. Fonctions principales
            console.log('3Ô∏è‚É£ FONCTIONS PRINCIPALES:');
            const functions = [
                'getTeamSwimmers',
                'getAllSwimmers',
                'renderAttendanceForm',
                'saveAttendanceData',
                'openAttendanceCalendarForEdit',
                'cycleAttendanceStatus'
            ];
            functions.forEach(fn => {
                const exists = typeof window[fn] === 'function';
                console.log(`  ${fn}(): ${exists ? '‚úÖ' : '‚ùå'}`);
            });
            console.log();
            
            // 4. Performance
            console.log('4Ô∏è‚É£ PERFORMANCE:');
            console.log(`  URL: ${window.location.href}`);
            console.log(`  Heure: ${new Date().toLocaleString('fr-FR')}`);
            console.log(`  Uptime: ${(performance.now() / 1000).toFixed(2)}s\n`);
            
            alert('‚úÖ Diagnostics termin√©s! Consultez la console (F12) pour les d√©tails complets.');
        }
        
        function clearLocalStorage() {
            if (confirm('‚ö†Ô∏è √ätes-vous s√ªr de vouloir effacer toutes les donn√©es localStorage?')) {
                localStorage.clear();
                alert('‚úÖ localStorage effac√©e');
                location.reload();
            }
        }
        
        // ============================================
        // UTILITAIRES
        // ============================================
        
        function updateCheck(elementId, status, text) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const icon = element.querySelector('.check-icon i');
            const textDiv = element.querySelector('div:last-child');
            
            element.className = 'check-item ' + status;
            
            if (status === 'pass') {
                icon.className = 'fas fa-check-circle';
            } else if (status === 'fail') {
                icon.className = 'fas fa-times-circle';
            } else {
                icon.className = 'fas fa-question-circle';
            }
            
            textDiv.textContent = text;
        }
        
        // Auto-test au chargement
        window.addEventListener('load', () => {
            console.log('üöÄ Page de test charg√©e');
            console.log('üìç Serveur local: http://localhost:8000');
        });
    </script>
</body>
</html>
