<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des √âquipes - Suivi des Nageurs</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="btn-back" title="Retour √† l'accueil">
                    <i class="fas fa-arrow-left"></i> Retour
                </a>
                <div class="logo">
                    <h1>Gestion des √âquipes</h1>
                </div>
                <button class="nav-toggle">‚ò∞</button>
            </div>
            
            <!-- Navigation -->
            <nav>
                <ul>
                    <li><a href="#apercu" class="active">üè† Aper√ßu</a></li>
                    <li><a href="#saisie">üìù Saisie de Donn√©es</a></li>
                    <li><a href="#analyse">üìä Analyse & Rapports</a></li>
                    <li><a href="#gestion">‚öôÔ∏è Gestion √âquipes</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="dashboard">
        <div class="container">
            
            <!-- S√©lecteur d'√©quipe global (sticky) -->
            <div class="card sticky-selector">
                <div class="card-body" style="padding: 20px;">
                    <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 300px;">
                            <label for="globalTeamSelector" style="font-weight: bold; display: block; margin-bottom: 8px;">
                                <i class="fas fa-users"></i> √âquipe Active :
                            </label>
                            <select id="globalTeamSelector" class="form-control" style="font-size: 1.1rem;" onchange="window.onGlobalTeamSelect()">
                                <option value="">-- Aucune √©quipe s√©lectionn√©e --</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: flex-end;">
                            <button class="btn btn-primary" onclick="window.showCreateTeamModal()">
                                <i class="fas fa-plus"></i> Nouvelle √âquipe
                            </button>
                            <button class="btn btn-info" onclick="window.goToManagement()" title="G√©rer les √©quipes">
                                <i class="fas fa-cog"></i>
                            </button>
                        </div>
                    </div>
                    <div id="quickTeamInfo" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0; display: none;">
                        <div style="display: flex; gap: 30px; flex-wrap: wrap; font-size: 0.95rem;">
                            <span><strong>üë• Nageurs:</strong> <span id="quickSwimmerCount">0</span></span>
                            <span><strong>üìã Cat√©gorie:</strong> <span id="quickTeamCategory">-</span></span>
                            <span><strong>üìä S√©ances:</strong> <span id="quickSessionCount">0</span></span>
                            <span><strong>‚úÖ Taux pr√©sence:</strong> <span id="quickAttendanceRate">-</span></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SECTION 1: APER√áU G√âN√âRAL -->
            <section id="apercu" class="section active">
                <div class="dashboard-header">
                    <h2>üè† Aper√ßu de l'√âquipe</h2>
                    <p style="color: #666; margin-top: 5px;">Vue d'ensemble des statistiques cl√©s et activit√© r√©cente</p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="window.refreshDashboard()">
                            <i class="fas fa-sync"></i> Actualiser
                        </button>
                        <button class="btn btn-danger" onclick="window.exportTeamPDF()">
                            <i class="fas fa-file-pdf"></i> Export PDF
                        </button>
                        <button class="btn btn-success" onclick="window.exportTeamExcel()">
                            <i class="fas fa-file-excel"></i> Export Excel
                        </button>
                        <button class="btn btn-warning" onclick="window.createTestTeam()" style="background: #ff9800; border-color: #ff9800;">
                            <i class="fas fa-vial"></i> Test √âquipe (D√©mo)
                        </button>
                    </div>
                </div>

                <div id="overviewContent">
                    <div class="card" style="text-align: center; padding: 60px 20px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);">
                        <i class="fas fa-users" style="font-size: 4rem; color: #1a73e8; margin-bottom: 20px;"></i>
                        <h3 style="color: #333; margin-bottom: 10px;">S√©lectionnez une √©quipe pour commencer</h3>
                        <p style="color: #666; font-size: 1.1rem;">Utilisez le s√©lecteur ci-dessus ou cr√©ez une nouvelle √©quipe</p>
                    </div>
                </div>

                <!-- Stats rapides -->
                <div id="quickStatsSection" style="display: none; margin-top: 30px;">
                    <h3 style="margin-bottom: 20px;"><i class="fas fa-chart-line"></i> Statistiques Cl√©s</h3>
                    <div class="cards-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                        <!-- Stats cards -->
                    </div>
                </div>

                <!-- Pr√©sences r√©centes -->
                <div id="recentAttendanceSection" style="display: none; margin-top: 30px;">
                    <!-- Contenu -->
                </div>

                <!-- Alertes -->
                <div id="alertsSection" style="display: none; margin-top: 30px;">
                    <!-- Contenu -->
                </div>
            </section>

            <!-- SECTION 2: SAISIE DE DONN√âES -->
            <section id="saisie" class="section">
                <div class="dashboard-header">
                    <h2>üìù Saisie de Donn√©es</h2>
                    <p style="color: #666; margin-top: 10px;">Enregistrer les pr√©sences et saisir les donn√©es pour toute l'√©quipe rapidement</p>
                </div>

                <div id="dataEntryContent">
                    <div class="card" style="text-align: center; padding: 40px 20px;">
                        <i class="fas fa-edit" style="font-size: 3rem; color: #999; margin-bottom: 15px;"></i>
                        <p style="color: #999; font-size: 1.1rem;">S√©lectionnez une √©quipe pour saisir des donn√©es</p>
                    </div>
                </div>

                <!-- Pr√©sences -->
                <div id="attendanceEntrySection" style="display: none; margin-bottom: 30px;">
                    <div class="card">
                        <div class="card-header" style="background: linear-gradient(135deg, #28a745 0%, #34ce57 100%); color: white;">
                            <h3 style="color: white; margin: 0;"><i class="fas fa-clipboard-check"></i> Feuille de Pr√©sence</h3>
                        </div>
                        <div class="card-body" style="padding: 20px;">
                            <button class="btn btn-primary" onclick="window.showAttendanceModal()" style="width: 100%;">
                                <i class="fas fa-list"></i> Saisie Rapide des Pr√©sences
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Types de saisie group√©e -->
                <div id="bulkEntrySection" style="display: none;">
                    <h3 style="margin-bottom: 20px;"><i class="fas fa-database"></i> Saisie Group√©e de Donn√©es</h3>
                    <div class="cards-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        
                        <div class="card" style="border-left: 4px solid #1a73e8; transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)';">
                            <div class="card-header" style="padding: 15px;">
                                <h3 class="card-title" style="font-size: 1.1rem; margin: 0;">üòä Bien-√™tre</h3>
                            </div>
                            <div class="card-body" style="padding: 15px;">
                                <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">Sommeil, fatigue, douleur et stress</p>
                                <button class="btn btn-primary bulk-entry-btn" data-type="wellbeing" style="width: 100%;">
                                    <i class="fas fa-edit"></i> Ouvrir
                                </button>
                            </div>
                        </div>

                        <div class="card" style="border-left: 4px solid #28a745; transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)';">
                            <div class="card-header" style="padding: 15px;">
                                <h3 class="card-title" style="font-size: 1.1rem; margin: 0;">üèä Entra√Ænement</h3>
                            </div>
                            <div class="card-body" style="padding: 15px;">
                                <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">Volume, RPE et charge</p>
                                <button class="btn btn-primary bulk-entry-btn" data-type="training" style="width: 100%;">
                                    <i class="fas fa-edit"></i> Ouvrir
                                </button>
                            </div>
                        </div>

                        <div class="card" style="border-left: 4px solid #ffc107; transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)';">
                            <div class="card-header" style="padding: 15px;">
                                <h3 class="card-title" style="font-size: 1.1rem; margin: 0;">üí™ Performance</h3>
                            </div>
                            <div class="card-body" style="padding: 15px;">
                                <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">Tests VMA, force et puissance</p>
                                <button class="btn btn-primary bulk-entry-btn" data-type="performance" style="width: 100%;">
                                    <i class="fas fa-edit"></i> Ouvrir
                                </button>
                            </div>
                        </div>

                        <div class="card" style="border-left: 4px solid #dc3545; transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)';">
                            <div class="card-header" style="padding: 15px;">
                                <h3 class="card-title" style="font-size: 1.1rem; margin: 0;">üè• M√©dical</h3>
                            </div>
                            <div class="card-body" style="padding: 15px;">
                                <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">Disponibilit√© et sant√©</p>
                                <button class="btn btn-primary bulk-entry-btn" data-type="medical" style="width: 100%;">
                                    <i class="fas fa-edit"></i> Ouvrir
                                </button>
                            </div>
                        </div>

                        <div class="card" style="border-left: 4px solid #17a2b8; transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)';">
                            <div class="card-header" style="padding: 15px;">
                                <h3 class="card-title" style="font-size: 1.1rem; margin: 0;">üèÜ Courses</h3>
                            </div>
                            <div class="card-body" style="padding: 15px;">
                                <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">Temps de course</p>
                                <button class="btn btn-primary bulk-entry-btn" data-type="race" style="width: 100%;">
                                    <i class="fas fa-edit"></i> Ouvrir
                                </button>
                            </div>
                        </div>

                        <div class="card" style="border-left: 4px solid #6f42c1; transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)';">
                            <div class="card-header" style="padding: 15px;">
                                <h3 class="card-title" style="font-size: 1.1rem; margin: 0;">üéØ Technique</h3>
                            </div>
                            <div class="card-body" style="padding: 15px;">
                                <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">√âvaluations techniques</p>
                                <button class="btn btn-primary bulk-entry-btn" data-type="technical" style="width: 100%;">
                                    <i class="fas fa-edit"></i> Ouvrir
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION 3: ANALYSE & RAPPORTS -->
            <section id="analyse" class="section">
                <div class="dashboard-header">
                    <h2>üìä Analyse & Rapports</h2>
                    <p style="color: #666; margin-top: 5px;">Statistiques d√©taill√©es, graphiques d'√©volution, comparaisons et recommandations</p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="window.refreshAnalysis()">
                            <i class="fas fa-sync"></i> Actualiser
                        </button>
                        <button class="btn btn-danger" onclick="window.exportAttendancePDF()">
                            <i class="fas fa-file-pdf"></i> Rapport Pr√©sences
                        </button>
                    </div>
                </div>

                <div id="analysisContent">
                    <div class="card" style="text-align: center; padding: 40px 20px;">
                        <i class="fas fa-chart-bar" style="font-size: 3rem; color: #999; margin-bottom: 15px;"></i>
                        <p style="color: #999; font-size: 1.1rem;">S√©lectionnez une √©quipe pour voir les analyses</p>
                    </div>
                </div>

                <!-- Onglets d'analyse -->
                <div id="analysisTabsSection" style="display: none;">
                    <div class="analysis-tabs" style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; flex-wrap: wrap;">
                        <button class="analysis-tab active" data-tab="attendance" onclick="window.switchAnalysisTab('attendance')">
                            <i class="fas fa-calendar-check"></i> Pr√©sences
                        </button>
                        <button class="analysis-tab" data-tab="performance" onclick="window.switchAnalysisTab('performance')">
                            <i class="fas fa-chart-line"></i> Performances
                        </button>
                        <button class="analysis-tab" data-tab="comparisons" onclick="window.switchAnalysisTab('comparisons')">
                            <i class="fas fa-users"></i> Comparaisons
                        </button>
                        <button class="analysis-tab" data-tab="recommendations" onclick="window.switchAnalysisTab('recommendations')">
                            <i class="fas fa-lightbulb"></i> Recommandations
                        </button>
                        <button class="analysis-tab" data-tab="calendar" onclick="window.switchAnalysisTab('calendar')">
                            <i class="fas fa-calendar"></i> Calendrier
                        </button>
                    </div>

                    <!-- Contenu Pr√©sences -->
                    <div id="attendanceAnalysis" class="analysis-content active">
                        <div id="attendanceStatsSection"></div>
                        <div id="attendanceChartsSection" style="margin-top: 30px;"></div>
                    </div>

                    <!-- Contenu Performances -->
                    <div id="performanceAnalysis" class="analysis-content" style="display: none;">
                        <div id="teamStatsSection"></div>
                    </div>

                    <!-- Contenu Comparaisons -->
                    <div id="comparisonsAnalysis" class="analysis-content" style="display: none;">
                        <div id="comparisonsSection"></div>
                    </div>

                    <!-- Contenu Recommandations -->
                    <div id="recommendationsAnalysis" class="analysis-content" style="display: none;">
                        <div id="recommendationsSection"></div>
                    </div>

                    <!-- Contenu Calendrier -->
                    <div id="calendarAnalysis" class="analysis-content" style="display: none;">
                        <div id="calendarSection"></div>
                    </div>
                </div>
            </section>

            <!-- SECTION 4: GESTION √âQUIPES -->
            <!-- SECTION 4: GESTION √âQUIPES -->
            <section id="gestion" class="section">
                <div class="dashboard-header">
                    <h2>‚öôÔ∏è Gestion des √âquipes</h2>
                    <p style="color: #666; margin-top: 5px;">Cr√©er, modifier et organiser vos √©quipes et leurs membres</p>
                    <button class="btn btn-primary" onclick="window.showCreateTeamModal()">
                        <i class="fas fa-plus"></i> Cr√©er une √âquipe
                    </button>
                </div>

                <!-- Liste des √©quipes -->
                <div class="cards-grid" id="teamsList">
                    <div class="card">
                        <p style="text-align: center; color: #999; padding: 40px;">
                            <i class="fas fa-users" style="font-size: 3rem; display: block; margin-bottom: 15px; color: #ccc;"></i>
                            Aucune √©quipe cr√©√©e.<br>Cliquez sur "Cr√©er une √âquipe" pour commencer.
                        </p>
                    </div>
                </div>

                <!-- D√©tails de l'√©quipe s√©lectionn√©e -->
                <div id="teamDetailsSection" style="display: none; margin-top: 30px;">
                    <div class="card">
                        <div class="card-header" style="background: linear-gradient(135deg, #1a73e8 0%, #4285f4 100%); color: white;">
                            <h3 id="selectedTeamName" style="color: white; margin: 0;">Nom de l'√©quipe</h3>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-light btn-sm" onclick="window.editTeam()">
                                    <i class="fas fa-edit"></i> Modifier
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="window.deleteTeam()">
                                    <i class="fas fa-trash"></i> Supprimer
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                                <div>
                                    <strong style="color: #666;">Description:</strong>
                                    <p id="selectedTeamDescription" style="margin: 5px 0 0 0;"></p>
                                </div>
                                <div>
                                    <strong style="color: #666;">Cat√©gorie:</strong>
                                    <p id="selectedTeamCategory" style="margin: 5px 0 0 0;"></p>
                                </div>
                                <div>
                                    <strong style="color: #666;">Nombre de nageurs:</strong>
                                    <p id="selectedTeamCount" style="margin: 5px 0 0 0; font-size: 1.5rem; font-weight: bold; color: #1a73e8;">0</p>
                                </div>
                            </div>
                            
                            <div style="border-top: 2px solid #e0e0e0; padding-top: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                    <h4><i class="fas fa-swimmer"></i> Membres de l'√âquipe</h4>
                                    <button class="btn btn-info" onclick="window.showAddSwimmersModal()">
                                        <i class="fas fa-user-plus"></i> Ajouter des Nageurs
                                    </button>
                                </div>
                                <div id="teamSwimmersList" class="swimmer-list" style="max-height: 400px; overflow-y: auto;">
                                    <!-- Liste des nageurs -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- Modal Cr√©ation/√âdition √âquipe -->
    <div id="teamModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="window.closeTeamModal()">&times;</span>
            <h2 id="teamModalTitle">Nouvelle √âquipe</h2>
            <form id="teamForm" onsubmit="window.saveTeam(event)">
                <div class="form-group">
                    <label for="teamName">Nom de l'√©quipe *</label>
                    <input type="text" id="teamName" required>
                </div>
                <div class="form-group">
                    <label for="teamDescription">Description</label>
                    <textarea id="teamDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="teamCategory">Cat√©gorie</label>
                    <select id="teamCategory">
                        <option value="Jeunes">Jeunes</option>
                        <option value="Espoirs">Espoirs</option>
                        <option value="Seniors">Seniors</option>
                        <option value="√âlite">√âlite</option>
                        <option value="Masters">Masters</option>
                        <option value="Mixte">Mixte</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="window.closeTeamModal()">Annuler</button>
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Ajout Nageurs -->
    <div id="swimmersModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="window.closeSwimmersModal()">&times;</span>
            <h2>Ajouter des nageurs √† l'√©quipe</h2>
            <div id="availableSwimmersList" class="checkbox-list">
                <!-- Liste des nageurs disponibles -->
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="window.closeSwimmersModal()">Annuler</button>
                <button type="button" class="btn btn-primary" onclick="window.addSwimmersToTeam()">Ajouter</button>
            </div>
        </div>
    </div>

    <!-- Modal Saisie Facilit√©e -->
    <div id="bulkEntryModal" class="modal">
        <div class="modal-content" style="max-width: 95%; width: 1400px; max-height: 90vh; display: flex; flex-direction: column;">
            <div class="modal-header" style="flex-shrink: 0; border-bottom: 2px solid #ddd; padding: 20px;">
                <span class="close" onclick="window.closeBulkEntryModal()" style="font-size: 2rem; cursor: pointer;">&times;</span>
                <h2 id="bulkEntryModalTitle" style="margin: 0; color: #333;">Saisie Group√©e</h2>
                <p id="bulkEntryModalSubtitle" style="color: #666; margin: 5px 0 0 0;"></p>
            </div>
            
            <div style="flex: 1; overflow-y: auto; padding: 20px;">
                <div class="form-group" style="max-width: 300px; margin-bottom: 20px;">
                    <label for="bulkEntryDate"><strong>üìÖ Date :</strong></label>
                    <input type="date" id="bulkEntryDate" class="form-control">
                </div>
                
                <div id="bulkEntryForm">
                    <!-- Formulaire dynamique -->
                </div>
            </div>
            
            <div class="modal-footer" style="flex-shrink: 0; background: #f8f9fa; padding: 15px 20px; border-top: 2px solid #ddd; display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" class="btn btn-secondary" onclick="window.closeBulkEntryModal()">
                    <i class="fas fa-times"></i> Annuler
                </button>
                <button type="button" class="btn btn-primary" id="saveBulkEntryBtn" style="min-width: 150px;">
                    <i class="fas fa-save"></i> Enregistrer tout
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Feuille de Pr√©sence -->
    <div id="attendanceModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <span class="close" onclick="window.closeAttendanceModal()">&times;</span>
                <h2>üìã Feuille de Pr√©sence</h2>
            </div>
            
            <div style="padding: 20px;">
                <div class="form-group" style="max-width: 300px; margin-bottom: 30px;">
                    <label for="attendanceModalDate"><strong>üìÖ Date de la s√©ance :</strong></label>
                    <input type="date" id="attendanceModalDate" class="form-control">
                </div>
                
                <div id="attendanceModalList">
                    <!-- Liste des nageurs avec boutons A/P/E -->
                </div>
                
                <div class="form-actions" style="margin-top: 30px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="window.closeAttendanceModal()">Annuler</button>
                    <button type="button" class="btn btn-primary" onclick="window.saveAttendanceFromModal()">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="assets/js/equipe.js?v=20251119-03"></script>
</body>
</html>
